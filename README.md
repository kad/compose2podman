# compose2podman

> [!CAUTION]
> **⚠️ PROOF-OF-CONCEPT / NOT FOR PRODUCTION USE ⚠️**
>
> This project is a **proof-of-concept** tool completely generated by GitHub Copilot as a demonstration.
> 
> **Important limitations:**
> - ❌ **NOT tested with real-world Docker Compose files**
> - ❌ **NOT fully audited or verified for correctness**
> - ❌ **NOT intended for production environments**
> - ❌ **NO guarantees of functionality or reliability**
> - ❌ **Generated output may be incomplete or incorrect**
>
> **Use at your own risk for experimental purposes only.** Always verify generated configurations before using them.
> For production use, consider established tools like [podman-compose](https://github.com/containers/podman-compose) or manually written Quadlet files.

A CLI tool to convert Docker Compose files to Podman-compatible formats.

## Features

- **Kubernetes YAML Generation**: Convert Docker Compose to Kubernetes Pod YAML for `podman play kube`
- **Quadlet Files Generation**: Convert to Podman Quadlet format for systemd integration
- Support for common Docker Compose features:
  - Services → Containers
  - Networks → Podman networks
  - Volumes → Persistent volumes
  - Environment variables
  - Port mappings
  - Dependencies (depends_on)
  - Restart policies

## Installation

> [!WARNING]
> This is a proof-of-concept tool. See the warning at the top of this document before installing.

### From Release Binaries

Download pre-built binaries from the [releases page](https://github.com/kad/compose2podman/releases).

**Linux (amd64):**
```bash
wget https://github.com/kad/compose2podman/releases/latest/download/compose2podman_VERSION_linux_amd64.tar.gz
tar -xzf compose2podman_VERSION_linux_amd64.tar.gz
sudo mv compose2podman /usr/local/bin/
```

**macOS (arm64 - Apple Silicon):**
```bash
wget https://github.com/kad/compose2podman/releases/latest/download/compose2podman_VERSION_darwin_arm64.tar.gz
tar -xzf compose2podman_VERSION_darwin_arm64.tar.gz
sudo mv compose2podman /usr/local/bin/
```

**Windows:**
Download the `.zip` file for your architecture and extract it.

### From Package Manager

**Debian/Ubuntu (.deb):**
```bash
wget https://github.com/kad/compose2podman/releases/latest/download/compose2podman_VERSION_linux_amd64.deb
sudo dpkg -i compose2podman_VERSION_linux_amd64.deb
```

**RHEL/Fedora/CentOS (.rpm):**
```bash
wget https://github.com/kad/compose2podman/releases/latest/download/compose2podman_VERSION_linux_amd64.rpm
sudo rpm -i compose2podman_VERSION_linux_amd64.rpm
```

**Alpine (.apk):**
```bash
wget https://github.com/kad/compose2podman/releases/latest/download/compose2podman_VERSION_linux_amd64.apk
sudo apk add --allow-untrusted compose2podman_VERSION_linux_amd64.apk
```

**Arch Linux:**
```bash
wget https://github.com/kad/compose2podman/releases/latest/download/compose2podman_VERSION_linux_amd64.pkg.tar.zst
sudo pacman -U compose2podman_VERSION_linux_amd64.pkg.tar.zst
```

### From Source

```bash
go install github.com/kad/compose2podman/cmd/compose2podman@latest
```

Or build from source:

```bash
git clone https://github.com/kad/compose2podman.git
cd compose2podman
make build
sudo mv compose2podman /usr/local/bin/
```

Or with GoReleaser for all platforms:

```bash
git clone https://github.com/kad/compose2podman.git
cd compose2podman
make snapshot  # Builds for all platforms in dist/
```

## Usage

### Basic Usage

```bash
# Use default compose file (auto-detects compose.yaml, compose.yml, docker-compose.yaml, or docker-compose.yml)
compose2podman

# Specify input file
compose2podman -input docker-compose.yaml
compose2podman -i docker-compose.yaml  # Short form

# Generate Kubernetes YAML (default)
compose2podman -i docker-compose.yaml -type kube -output pod.yaml
compose2podman -i docker-compose.yaml -t kube -o pod.yaml  # Short form

# Generate Podman Quadlet files
compose2podman -i docker-compose.yaml -type quadlet -output ./quadlet-files
compose2podman -i docker-compose.yaml -t quadlet -o ./quadlet-files  # Short form

# Suppress warning message
compose2podman -i docker-compose.yaml -no-warning
compose2podman -i docker-compose.yaml -q  # Short form
```

### Flags

| Long Flag | Short | Default | Description |
|-----------|-------|---------|-------------|
| `-input` | `-i` | (auto-detect) | Path to docker-compose file |
| `-type` | `-t` | `kube` | Output type: `kube` or `quadlet` |
| `-output` | `-o` | `pod.yaml` | Output file (kube) or directory (quadlet) |
| `-pod-name` | `-p` | `compose-pod` | Pod name for Kubernetes output |
| `-version` | `-v` | - | Show version information |
| `-no-warning` | `-q` | - | Suppress proof-of-concept warning |

### Auto-Detection of Compose Files

If no input file is specified, `compose2podman` automatically looks for compose files in this order:
1. `compose.yaml` (preferred by Docker Compose v2)
2. `compose.yml`
3. `docker-compose.yaml`
4. `docker-compose.yml`

This matches the behavior of `docker compose` and `docker-compose` commands.

### Basic Usage

```bash
# Use default compose file (auto-detects compose.yaml, compose.yml, docker-compose.yaml, or docker-compose.yml)
compose2podman

# Specify input file
compose2podman -input docker-compose.yaml
compose2podman -i docker-compose.yaml  # Short form

# Generate Kubernetes YAML (default)
compose2podman -i docker-compose.yaml -type kube -output pod.yaml
compose2podman -i docker-compose.yaml -t kube -o pod.yaml  # Short form

# Generate Podman Quadlet files
compose2podman -i docker-compose.yaml -type quadlet -output ./quadlet-files
compose2podman -i docker-compose.yaml -t quadlet -o ./quadlet-files  # Short form

# Suppress warning message
compose2podman -i docker-compose.yaml -no-warning
compose2podman -i docker-compose.yaml -q  # Short form
```

### Flags

| Long Flag | Short | Default | Description |
|-----------|-------|---------|-------------|
| `-input` | `-i` | (auto-detect) | Path to docker-compose file |
| `-type` | `-t` | `kube` | Output type: `kube` or `quadlet` |
| `-output` | `-o` | `pod.yaml` (kube) / `quadlet-output` (quadlet) | Output file or directory |
| `-pod-name` | `-p` | `compose-pod` | Pod name for Kubernetes output |
| `-version` | `-v` | - | Show version information |
| `-no-warning` | `-q` | - | Suppress proof-of-concept warning |

### Auto-Detection of Compose Files

If no input file is specified, `compose2podman` automatically looks for compose files in this order:
1. `compose.yaml` (preferred by Docker Compose v2)
2. `compose.yml`
3. `docker-compose.yaml`
4. `docker-compose.yml`

This matches the behavior of `docker compose` and `docker-compose` commands.

### Generate Kubernetes YAML

```bash
compose2podman -i docker-compose.yaml -t kube -o pod.yaml
```

Then use with Podman:

```bash
podman play kube pod.yaml
```

### Generate Quadlet Files

```bash
compose2podman -i docker-compose.yaml -t quadlet -o ./quadlet-files
```

Then install:

```bash
# For user services
cp quadlet-files/* ~/.config/containers/systemd/
systemctl --user daemon-reload

# For system services
sudo cp quadlet-files/* /etc/containers/systemd/
sudo systemctl daemon-reload
```
```

## Examples

### Simple Redis Service

Input (`docker-compose.yaml`):
```yaml
version: "3"
services:
  redis:
    image: redis:alpine
    ports:
      - "6379:6379"
    restart: always
```

Generate Kubernetes YAML:
```bash
compose2podman -input docker-compose.yaml -type kube
```

Output (`pod.yaml`):
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: compose-pod
  labels:
    app: compose2podman
spec:
  containers:
  - name: redis
    image: redis:alpine
    ports:
    - containerPort: 6379
      hostPort: 6379
  restartPolicy: Always
```

### Multi-Service Application

See `testdata/docker-compose.yaml` for a complete example with:
- Multiple services (web, api, database)
- Networks (frontend, backend)
- Volumes (persistent data)
- Environment variables
- Service dependencies

## Supported Features

| Docker Compose Feature | Kubernetes YAML | Quadlet |
|----------------------|-----------------|---------|
| services | ✓ | ✓ |
| image | ✓ | ✓ |
| ports | ✓ | ✓ |
| environment | ✓ | ✓ |
| volumes | ✓ | ✓ |
| networks | ✓ | ✓ |
| depends_on | Partial | ✓ |
| restart | ✓ | ✓ |
| command | ✓ | ✓ |
| entrypoint | ✓ | - |
| working_dir | ✓ | ✓ |
| user | ✓ | ✓ |
| hostname | - | ✓ |
| privileged | ✓ | ✓ |
| cap_add/cap_drop | - | ✓ |
| labels | - | ✓ |

## Limitations

- `build` directive is not supported (must use pre-built images)
- `extends` is not supported
- Some advanced networking features may not translate perfectly
- Host path volumes in Kubernetes output need manual PVC creation

## Requirements

- **Kubernetes YAML**: Podman 3.0+ with `podman play kube` support
- **Quadlet**: Podman 4.4+ (Quadlet introduced in Podman 4.4.0)

## Contributing

> [!NOTE]
> This project was generated as a proof-of-concept by GitHub Copilot. Contributions are welcome to improve functionality, add tests with real data, and make it production-ready.

Contributions are welcome! Please feel free to submit a Pull Request.

## License

MIT License - see LICENSE file for details

## See Also

- [Podman Documentation](https://docs.podman.io/)
- [Podman Play Kube](https://docs.podman.io/en/latest/markdown/podman-play-kube.1.html)
- [Podman Quadlet](https://docs.podman.io/en/latest/markdown/podman-systemd.unit.5.html)
- [Docker Compose Specification](https://docs.docker.com/compose/compose-file/)
